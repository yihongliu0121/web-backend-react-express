{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://project2/./src/services.js","webpack://project2/webpack/bootstrap","webpack://project2/webpack/runtime/define property getters","webpack://project2/webpack/runtime/hasOwnProperty shorthand","webpack://project2/webpack/runtime/make namespace object","webpack://project2/./src/chat.js"],"sourcesContent":["export function fetchSession() {\n    return fetch('/api/v1/session', {\n        method: 'GET',\n    })\n    .catch(() => Promise.reject({ error: 'network-error' }))\n    .then((response) => {\n        if (response.ok) {\n            return response.json();\n        }\n        return response.json().then(err => Promise.reject(err));\n    });\n}\n\nexport function fetchLogout() {\n    return fetch('/api/v1/session', {\n        method: 'DELETE',\n    })\n    .catch(() => Promise.reject({ error: 'network-error' }))\n    .then((response) => {\n        if (response.ok) {\n            return response.json();\n        }\n        return response.json().then(err => Promise.reject(err));\n    });\n}\n\nexport function fetchLogin(username) {\n    return fetch('/api/v1/session', {\n        method: 'POST',\n        headers: new Headers({\n            'content-type': 'application/json'\n        }),\n        body: JSON.stringify({ username }),\n    })\n    .catch(() => Promise.reject({ error: 'network-error' }))\n    .then((response) => {\n        if (response.ok) {\n            return response.json();\n        }\n        return response.json().then(err => Promise.reject(err));\n    });\n}\n\nexport function fetchMessages() {\n    return fetch('/api/v1/message', {\n        method: 'GET',\n    })\n    .catch(() => Promise.reject({ error: 'network-error' }))\n    .then((response) => {\n        if (response.ok) {\n            return response.json();\n        }\n        return response.json().then(err => Promise.reject(err));\n    });\n}\n\nexport function fetchSendMessage(message) {\n    return fetch('/api/v1/message', {\n        method: 'POST',\n        headers: new Headers({\n            'content-type': 'application/json',\n        }),\n        body: JSON.stringify({ message }),\n    })\n    .catch(() => Promise.reject({ error: 'network-error' }))\n    .then((response) => {\n        if (response.ok) {\n            return response.json();\n        }\n        return response.json().then(err => Promise.reject(err));\n    });\n}\n\nexport function fetchUserData() {\n    return fetch('/api/v1/user', {\n        method: 'GET',\n    })\n    .catch(() => Promise.reject({ error: 'network-error' }))\n    .then((response) => {\n        if (response.ok) {\n            return response.json();\n        }\n        return response.json().then(err => Promise.reject(err));\n    });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {\n    fetchSession,\n    fetchLogout,\n    fetchLogin,\n    fetchMessages,\n    fetchSendMessage,\n    fetchUserData,\n  } from './services';\n\nconst MESSAGES = {\n    \"network-error\": 'Trouble connecting to the network!',\n    \"auth-missing\": 'Please login first!',\n    \"required-message\": 'Require message, please input a message!',\n    \"auth-insufficient\": 'Username can not be dog!',\n    \"required-username\": 'Your username is is invalid, please re-enter!',\n    \"default\": 'Something weird went wrong.',\n};\n\nconst contentEl = document.querySelector('.content');\nconst statusEl = document.querySelector('.status');\npollChat();\n//checkSession();\n\nfunction checkSession() {\nfetchSession()\n.then((sessions) => {\n        console.log(getActiveUser(sessions));\n        const activeUser = getActiveUser(sessions);\n        fetchMessages()\n        .then((messageList) => {\n            console.log(activeUser, messageList);\n            renderChatPage(activeUser, messageList);\n            renderStatus('');\n        })\n        .catch((error) => {\n            renderStatus(error);\n        });\n})\n.catch(() => renderLoginPage());  //it means there is not\n}\n\nfunction getActiveUser(sessions) {\n    let activeUser = [];\n    for (let key in sessions) {\n        activeUser.push(sessions[key].username);\n    }\n\n    return Array.from(new Set(activeUser));\n}\n\nfunction pollChat() {\n    checkSession();\n    setTimeout( pollChat, 5000 );\n}\n\n\n//listener\nfunction addAbilityToLogin() {\n    const buttonEl = document.querySelector(\".login-button\");\n    const usernameEl = document.querySelector(\".login-username\");\n    buttonEl.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        contentEl.innerHTML = renderLoading();\n        const username = usernameEl.value;\n        fetchLogin(username)\n        .then(() => {\n            checkSession();\n        })\n        .catch((error) => renderStatus(error));\n    });\n}\n\nfunction addAbilityToLogout() {\n    const buttonEl = document.querySelector(\".logout-button\");\n    buttonEl.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        fetchLogout()\n        .then(() => {\n            renderLoginPage();\n            renderStatus('');\n        })\n        .catch();\n    });\n}\n\nfunction addAbilityToSend() {\n    const buttonEl = document.querySelector(\".send-button\");\n    const textEl = document.querySelector(\".to-send\");\n    buttonEl.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        contentEl.innerHTML = renderLoading();\n        const text = textEl.value;\n        fetchSendMessage(text)\n        .then(checkSession)\n        .catch((error) => renderStatus(error));\n    });\n}\n\n//view pages\nfunction renderLoading() {\n    return `\n      <div class=\"login__waiting\">Loading</div>\n    ` \n}\n\n\nfunction renderStatus(message) {\n    //statusEl = document.querySelector('.status');\n    if (!message) {\n        statusEl.innerText = '';\n        return;\n    }\n    const key = message?.error ? message.error : \"default\";\n    statusEl.innerText = MESSAGES[key];\n}\n\nfunction renderLoginPage() {\n    contentEl.innerHTML = `\n    <div class=\"loginPage\">\n    <form action=\"#\">\n        <label for=\"username\">Username:</label>\n        <input class=\"login-username\" placeholder=\"please enter your username\">\n        <button class=\"login-button\" type=\"button\">Login</button>\n    </form>\n    </div>`;\n    addAbilityToLogin();\n}\n\nfunction renderChatPage(activeUser, messageList) {\n    contentEl.innerHTML =\n    `<h1>Online Users</h1>` +\n    `<ul class=\"users\">` +\n    activeUser.map( username => \n      `\n      <li>\n        <div class=\"user\">\n          <span class=\"username\">${username}</span>\n        </div>\n      </li>\n    `).join('') +\n    `</ul>` +\n    `<h1>Chat Messages</h1>` +\n    `<ul class=\"messages\">` +\n    Object.values(messageList).map\n    ( message => \n        `\n        <li>\n        <div class=\"message\">  \n            <div class=\"sender-info\">\n            <span class=\"username\">${message.sender}</span>\n            </div>\n            <p class=\"message-text\">${message.text}</p>\n        </div>\n        </li>\n        `  \n    ).join('') +         \n    `</ul>` + \n    `<div class=\"outgoing\">\n        <form action=\"#\">\n        <input class=\"to-send\" placeholder=\"Enter message to send\"/>\n        <button class=\"send-button\" type=\"submit\">Send</button>\n        </form>\n    </div> ` + \n    `\n    <button class=\"logout-button\">Logout</button>\n    `\n    ;\n    addAbilityToLogout();\n    addAbilityToSend();\n}"],"names":["fetchSession","fetch","method","Promise","reject","error","then","response","ok","json","err","fetchLogout","fetchLogin","username","headers","Headers","body","JSON","stringify","fetchMessages","fetchSendMessage","message","fetchUserData","MESSAGES","contentEl","document","querySelector","statusEl","pollChat","checkSession","sessions","console","log","getActiveUser","activeUser","messageList","renderChatPage","renderStatus","renderLoginPage","key","push","Array","from","Set","setTimeout","addAbilityToLogin","buttonEl","usernameEl","addEventListener","e","preventDefault","innerHTML","renderLoading","value","addAbilityToLogout","addAbilityToSend","textEl","text","innerText","map","join","Object","values","sender"],"sourceRoot":""}